# 系统概要设计

## 一、开发环境设计

### 1.1 基础软件环境
- **操作系统**: Windows 10/11, Linux (Ubuntu 20.04+), macOS 10.15+
- **JDK**: OpenJDK 17 或 Oracle JDK 17 (LTS版本)
- **Maven**: 3.6.0+ (推荐3.8.x版本)
- **IDE**: IntelliJ IDEA 2023.2+, Eclipse 2023-06+, VS Code
- **Git**: 2.25.0+ (版本控制)

### 1.2 数据库环境
- **MySQL**: 8.0.33+ (主数据库)
  - 字符集: utf8mb4
  - 排序规则: utf8mb4_unicode_ci
  - 存储引擎: InnoDB
  - 连接池: HikariCP (Spring Boot默认)
- **Redis**: 6.0.16+ (缓存数据库)
  - 内存要求: 最小512MB
  - 持久化: RDB + AOF
  - 最大内存策略: allkeys-lru
- **MinIO**: 8.5.13+ (对象存储服务)
  - 用途: 活动海报、图片文件存储
  - 存储要求: 最小10GB可用空间
  - 访问协议: HTTP/HTTPS
  - 分片策略: 标准桶(Bucket)存储

### 1.3 完整技术栈

#### 1.3.1 核心框架
- **Spring Boot**: 3.4.11（应用框架）
- **Spring Web**: 6.2.0（REST API）
- **Spring Data Redis**: 3.4.11（缓存）

#### 1.3.2 数据访问层
- **MyBatis**: 3.0.5（ORM框架）
- **MySQL Connector**: 8.2.0（数据库驱动）
- **MyBatis Spring Boot Starter**: 3.0.5（集成）

#### 1.3.3 认证与安全
- **JWT处理**: io.jsonwebtoken:jjwt-api:0.12.6
- **JWT实现**: io.jsonwebtoken:jjwt-impl:0.12.6  
- **JWT扩展**: io.jsonwebtoken:jjwt-jackson:0.12.6

#### 1.3.4 文件存储
- **MinIO客户端**: io.minio:minio:8.5.13

#### 1.3.5 API文档与工具
- **Lombok**: 1.18.34（代码简化）
- **Jackson**: com.fasterxml.jackson.core:jackson-databind (JSON处理)
- **Knife4J**: com.github.xiaoymin（生成接口文档）
- **pagehelper**: com.github.pagehelper（分页查询）


### 1.4 开发环境配置要求

#### 1.4.1 环境变量配置
```bash

# 数据库连接配置
DB_HOST=47.122.51.163
DB_PORT=3306
DB_NAME=activities_dev
DB_USERNAME=root
DB_PASSWORD=ECS_mysql_password

# Redis连接配置  
REDIS_HOST=47.122.51.163
REDIS_PORT=6379
无密码

# JWT配置
JWT_SECRET=your_256_bit_secret_key_here
JWT_EXPIRATION=86400000  # 24小时

# 文件存储配置
FILE_STORAGE_TYPE=minio  # minio/oss/s3
MINIO_ENDPOINT=http://47.122.51.163:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=activities
```



## 二、技术架构设计

### 2.1 分层架构模式

#### 2.1.1 整体架构图

```mermaid
graph TB
    subgraph "表现层 Presentation Layer"
        A[ActivityController<br/>活动管理控制器]
        B[AuthController<br/>认证控制器]
        C[RegistrationController<br/>报名控制器]
        D[PublicController<br/>公共接口控制器]
    end
    
    subgraph "业务逻辑层 Business Logic Layer"
        E[ActivityService<br/>活动业务服务]
        F[AuthService<br/>认证业务服务]
        G[RegistrationService<br/>报名业务服务]
        H[FileService<br/>文件业务服务]
        I[CacheService<br/>缓存业务服务]
    end
    
    subgraph "数据访问层 Data Access Layer"
        J[ActivityMapper<br/>活动数据访问]
        K[AdministratorMapper<br/>管理员数据访问]
        L[RegistrationMapper<br/>报名数据访问]
        M[SystemLogMapper<br/>日志数据访问]
    end
    
    subgraph "基础设施层 Infrastructure Layer"
        N[(MySQL<br/>关系数据库)]
        O[(Redis<br/>缓存数据库)]
        P[MinIO/OSS<br/>对象存储]
        Q[JWT<br/>认证令牌]
    end
    
    A --> E
    B --> F
    C --> G
    D --> E
    D --> G
    
    E --> J
    E --> I
    F --> K
    F --> Q
    G --> L
    G --> I
    H --> P
    I --> O
    
    J --> N
    K --> N
    L --> N
    M --> N
```

#### 2.1.2 MVC架构图

```mermaid
graph LR
    subgraph "客户端层 Client Layer"
        A[Web浏览器<br/>学生访问]
        B[管理后台<br/>管理员操作]
    end
    
    subgraph "Controller层"
        C[ActivityController]
        D[AuthController]
        E[RegistrationController]
    end
    
    subgraph "Service层"
        F[ActivityService]
        G[AuthService]
        H[RegistrationService]
        I[FileService]
    end
    
    subgraph "Mapper/Repository层"
        J[ActivityMapper]
        K[AdministratorMapper]
        L[RegistrationMapper]
    end
    
    subgraph "Model层"
        M[Activity Entity]
        N[Administrator Entity]
        O[Registration Entity]
    end
    
    subgraph "数据存储层"
        P[(MySQL)]
        Q[(Redis)]
        R[MinIO<br/>对象存储]
    end
    
    A --> C
    A --> E
    B --> C
    B --> D
    B --> E
    
    C --> F
    C --> I
    D --> G
    E --> H
    
    F --> J
    G --> K
    H --> L
    
    J --> M
    K --> N
    L --> O
    
    M --> P
    N --> P
    O --> P
    F --> Q
    H --> Q
    I --> R
```

#### 2.1.3 系统部署架构图

```mermaid
graph TB
    subgraph "负载均衡层"
        LB[Nginx/ALB<br/>负载均衡器]
    end
    
    subgraph "应用服务集群"
        APP1[Spring Boot App 1<br/>:8080]
        APP2[Spring Boot App 2<br/>:8080]
        APP3[Spring Boot App 3<br/>:8080]
    end
    
    subgraph "缓存集群"
        REDIS1[(Redis Master<br/>:6379)]
        REDIS2[(Redis Slave 1<br/>:6379)]
        REDIS3[(Redis Slave 2<br/>:6379)]
    end
    
    subgraph "数据库集群"
        DB1[(MySQL Master<br/>:3306)]
        DB2[(MySQL Slave 1<br/>:3306)]
        DB3[(MySQL Slave 2<br/>:3306)]
    end
    
    subgraph "文件存储"
        MINIO[MinIO Cluster<br/>:9000]
    end
    
    subgraph "监控与日志"
        MONITOR[Prometheus + Grafana]
        LOG[ELK Stack]
    end
    
    LB --> APP1
    LB --> APP2
    LB --> APP3
    
    APP1 --> REDIS1
    APP2 --> REDIS1
    APP3 --> REDIS1
    
    REDIS2 --> REDIS1
    REDIS3 --> REDIS1
    
    APP1 --> DB1
    APP2 --> DB1
    APP3 --> DB1
    
    DB2 --> DB1
    DB3 --> DB1
    
    APP1 --> MINIO
    APP2 --> MINIO
    APP3 --> MINIO
    
    APP1 --> MONITOR
    APP2 --> MONITOR
    APP3 --> MONITOR
    
    APP1 --> LOG
    APP2 --> LOG
    APP3 --> LOG
```

#### 2.1.4 数据流架构图

```mermaid
sequenceDiagram
    participant Client as 客户端
    participant Controller as Controller层
    participant Service as Service层
    participant Cache as Redis缓存
    participant DB as MySQL数据库
    participant Storage as 文件存储
    
    Client->>Controller: HTTP请求
    Controller->>Service: 调用业务方法
    Service->>Cache: 检查缓存
    alt 缓存命中
        Cache-->>Service: 返回缓存数据
    else 缓存未命中
        Service->>DB: 查询数据库
        DB-->>Service: 返回数据
        Service->>Cache: 更新缓存
    end
    
    alt 文件操作
        Service->>Storage: 文件上传/下载
        Storage-->>Service: 文件操作结果
    end
    
    Service-->>Controller: 返回业务结果
    Controller-->>Client: HTTP响应
```


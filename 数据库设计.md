# 数据库设计文档

## 一、设计原则

### 1.1 范式要求
- **遵循第三范式（3NF）**：
  - 第一范式（1NF）：所有字段不可再分，原子性
  - 第二范式（2NF）：非主键字段完全依赖于主键
  - 第三范式（3NF）：非主键字段不存在传递依赖

### 1.2 外键策略
- **使用逻辑外键**：通过应用层代码维护数据一致性
- **禁止物理外键**：避免锁表、性能问题和分库分表障碍
- **索引策略**：在逻辑外键字段上建立普通索引提升查询性能

### 1.3 通用设计规范
- **字符集**：utf8mb4（支持emoji等4字节字符）
- **排序规则**：utf8mb4_unicode_ci（不区分大小写）
- **存储引擎**：InnoDB（支持事务、行级锁）
- **主键策略**：使用BIGINT自增ID，预留足够增长空间
- **时间字段**：统一使用DATETIME类型，便于时区处理
- **软删除**：使用is_deleted标记删除，保留历史数据
- **审计字段**：create_time、update_time、creator、updater

---

## 二、数据库表设计

### 2.1 活动表（activities）

**表说明**：存储活动的完整信息

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 | 索引 |
|--------|---------|------|---------|--------|------|------|
| id | BIGINT | 20 | NOT NULL | AUTO_INCREMENT | 活动ID，主键 | PRIMARY KEY |
| activity_name | VARCHAR | 100 | NOT NULL | - | 活动名称 | INDEX |
| activity_description | TEXT | - | NOT NULL | - | 活动描述（富文本） | - |
| activity_type | VARCHAR | 50 | NULL | '其他' | 活动类型（学术讲座/文体活动/志愿服务/社团活动/竞赛活动/其他） | INDEX |
| activity_status | TINYINT | 1 | NOT NULL | 0 | 活动状态：0-未发布，1-报名中，2-报名结束，3-进行中，4-已结束，5-已取消 | INDEX |
| start_time | DATETIME | - | NOT NULL | - | 活动开始时间 | INDEX |
| end_time | DATETIME | - | NOT NULL | - | 活动结束时间 | - |
| location | VARCHAR | 200 | NOT NULL | - | 活动地点 | - |
| organizer | VARCHAR | 100 | NOT NULL | - | 主办方/组织者 | - |
| contact_person | VARCHAR | 50 | NOT NULL | - | 负责人姓名 | - |
| contact_phone | VARCHAR | 20 | NOT NULL | - | 联系电话 | - |
| contact_email | VARCHAR | 100 | NULL | - | 联系邮箱 | - |
| poster_url | VARCHAR | 500 | NULL | - | 活动海报URL（存储在MinIO） | - |
| max_participants | INT | 11 | NULL | - | 最大报名人数（NULL表示不限） | - |
| current_participants | INT | 11 | NOT NULL | 0 | 当前报名人数（冗余字段，提升查询性能） | - |
| registration_start_time | DATETIME | - | NULL | - | 报名开始时间 | - |
| registration_end_time | DATETIME | - | NULL | - | 报名截止时间 | INDEX |
| registration_requirement | TEXT | - | NULL | - | 报名要求说明 | - |
| check_in_start_time | DATETIME | - | NULL | - | 签到开始时间（活动开始前30分钟） | - |
| check_in_end_time | DATETIME | - | NULL | - | 签到截止时间（活动结束后1小时） | - |
| publish_time | DATETIME | - | NULL | - | 发布时间 | INDEX |
| creator_id | BIGINT | 20 | NOT NULL | - | 创建者ID（逻辑外键关联administrators.id） | INDEX |
| is_deleted | TINYINT | 1 | NOT NULL | 0 | 软删除标记：0-未删除，1-已删除 | INDEX |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 记录创建时间 | - |
| update_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间 | - |

**索引设计**：
```sql
PRIMARY KEY (id),
INDEX idx_activity_name (activity_name),
INDEX idx_activity_type (activity_type),
INDEX idx_activity_status (activity_status),
INDEX idx_start_time (start_time),
INDEX idx_registration_end_time (registration_end_time),
INDEX idx_publish_time (publish_time),
INDEX idx_creator_id (creator_id),
INDEX idx_is_deleted (is_deleted),
INDEX idx_status_deleted (activity_status, is_deleted)  -- 组合索引，提升列表查询
```

**范式分析**：
- 1NF：所有字段均为原子值
- 2NF：所有非主键字段完全依赖于id
- 3NF：无传递依赖（current_participants虽是冗余字段，但为性能考虑的反范式设计）

---

### 2.2 管理员表（administrators）

**表说明**：存储活动管理员账号信息

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 | 索引 |
|--------|---------|------|---------|--------|------|------|
| id | BIGINT | 20 | NOT NULL | AUTO_INCREMENT | 管理员ID，主键 | PRIMARY KEY |
| username | VARCHAR | 50 | NOT NULL | - | 用户名（登录账号） | UNIQUE |
| password | VARCHAR | 255 | NOT NULL | - | 密码（BCrypt加密存储） | - |
| real_name | VARCHAR | 50 | NOT NULL | - | 真实姓名 | - |
| phone | VARCHAR | 20 | NULL | - | 手机号码 | INDEX |
| email | VARCHAR | 100 | NULL | - | 电子邮箱 | INDEX |
| department | VARCHAR | 100 | NULL | - | 所属部门/组织 | - |
| role_type | TINYINT | 1 | NOT NULL | 1 | 角色类型：1-普通管理员，2-超级管理员 | INDEX |
| account_status | TINYINT | 1 | NOT NULL | 1 | 账号状态：0-禁用，1-启用 | INDEX |
| last_login_time | DATETIME | - | NULL | - | 最后登录时间 | - |
| last_login_ip | VARCHAR | 50 | NULL | - | 最后登录IP | - |
| is_deleted | TINYINT | 1 | NOT NULL | 0 | 软删除标记：0-未删除，1-已删除 | INDEX |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 记录创建时间 | - |
| update_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间 | - |

**索引设计**：
```sql
PRIMARY KEY (id),
UNIQUE INDEX uk_username (username),
INDEX idx_phone (phone),
INDEX idx_email (email),
INDEX idx_role_type (role_type),
INDEX idx_account_status (account_status),
INDEX idx_is_deleted (is_deleted)
```

**范式分析**：
- 1NF：所有字段均为原子值
- 2NF：所有非主键字段完全依赖于id
- 3NF：无传递依赖

---

### 2.3 报名记录表（registrations）

**表说明**：存储学生报名活动的记录

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 | 索引 |
|--------|---------|------|---------|--------|------|------|
| id | BIGINT | 20 | NOT NULL | AUTO_INCREMENT | 报名ID，主键 | PRIMARY KEY |
| activity_id | BIGINT | 20 | NOT NULL | - | 活动ID（逻辑外键关联activities.id） | INDEX |
| student_name | VARCHAR | 50 | NOT NULL | - | 学生姓名 | INDEX |
| student_phone | VARCHAR | 20 | NOT NULL | - | 学生手机号（用于身份识别） | INDEX |
| student_college | VARCHAR | 100 | NOT NULL | - | 学生学院 | INDEX |
| student_major | VARCHAR | 100 | NULL | - | 学生专业 | - |
| student_grade | VARCHAR | 20 | NULL | - | 学生年级 | - |
| registration_status | TINYINT | 1 | NOT NULL | 1 | 报名状态：1-报名成功，2-已取消，3-已拒绝 | INDEX |
| check_in_status | TINYINT | 1 | NOT NULL | 0 | 签到状态：0-未签到，1-已签到，2-请假 | INDEX |
| check_in_time | DATETIME | - | NULL | - | 签到时间 | - |
| cancel_time | DATETIME | - | NULL | - | 取消报名时间 | - |
| cancel_reason | VARCHAR | 500 | NULL | - | 取消原因 | - |
| remark | VARCHAR | 500 | NULL | - | 备注信息 | - |
| registration_source | VARCHAR | 50 | NULL | 'WEB' | 报名来源：WEB-网页，QRCODE-二维码，API-接口 | - |
| registration_ip | VARCHAR | 50 | NULL | - | 报名时的IP地址 | - |
| is_deleted | TINYINT | 1 | NOT NULL | 0 | 软删除标记：0-未删除，1-已删除 | INDEX |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 报名时间（记录创建时间） | INDEX |
| update_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间 | - |

**索引设计**：
```sql
PRIMARY KEY (id),
INDEX idx_activity_id (activity_id),
INDEX idx_student_name (student_name),
INDEX idx_student_phone (student_phone),
INDEX idx_student_college (student_college),
INDEX idx_registration_status (registration_status),
INDEX idx_check_in_status (check_in_status),
INDEX idx_create_time (create_time),
INDEX idx_is_deleted (is_deleted),
UNIQUE INDEX uk_activity_phone (activity_id, student_phone, is_deleted),  -- 防重复报名
INDEX idx_activity_checkin (activity_id, check_in_status)  -- 查询签到情况
```

**范式分析**：
- 1NF：所有字段均为原子值
- 2NF：所有非主键字段完全依赖于id
- 3NF：无传递依赖

---

### 2.4 系统操作日志表（system_logs）

**表说明**：记录管理员的关键操作日志

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 | 索引 |
|--------|---------|------|---------|--------|------|------|
| id | BIGINT | 20 | NOT NULL | AUTO_INCREMENT | 日志ID，主键 | PRIMARY KEY |
| admin_id | BIGINT | 20 | NULL | - | 操作管理员ID（逻辑外键关联administrators.id） | INDEX |
| admin_username | VARCHAR | 50 | NULL | - | 操作管理员用户名（冗余字段，便于查询） | INDEX |
| operation_type | VARCHAR | 50 | NOT NULL | - | 操作类型：LOGIN-登录，LOGOUT-登出，CREATE_ACTIVITY-创建活动，UPDATE_ACTIVITY-更新活动，DELETE_ACTIVITY-删除活动，PUBLISH_ACTIVITY-发布活动 | INDEX |
| operation_module | VARCHAR | 50 | NOT NULL | - | 操作模块：AUTH-认证，ACTIVITY-活动，REGISTRATION-报名，SYSTEM-系统 | INDEX |
| operation_description | VARCHAR | 500 | NULL | - | 操作描述 | - |
| request_method | VARCHAR | 10 | NULL | - | 请求方法：GET/POST/PUT/DELETE | - |
| request_url | VARCHAR | 500 | NULL | - | 请求URL | - |
| request_params | TEXT | - | NULL | - | 请求参数（JSON格式） | - |
| request_ip | VARCHAR | 50 | NULL | - | 请求IP地址 | INDEX |
| user_agent | VARCHAR | 500 | NULL | - | 浏览器User-Agent | - |
| operation_status | TINYINT | 1 | NOT NULL | 1 | 操作状态：0-失败，1-成功 | INDEX |
| error_message | TEXT | - | NULL | - | 错误信息（操作失败时记录） | - |
| execution_time | INT | 11 | NULL | - | 执行耗时（毫秒） | - |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 操作时间（记录创建时间） | INDEX |

**索引设计**：
```sql
PRIMARY KEY (id),
INDEX idx_admin_id (admin_id),
INDEX idx_admin_username (admin_username),
INDEX idx_operation_type (operation_type),
INDEX idx_operation_module (operation_module),
INDEX idx_request_ip (request_ip),
INDEX idx_operation_status (operation_status),
INDEX idx_create_time (create_time),
INDEX idx_admin_time (admin_id, create_time)  -- 查询某管理员的操作历史
```

**范式分析**：
- 1NF：所有字段均为原子值
- 2NF：所有非主键字段完全依赖于id
- 3NF：admin_username虽是冗余字段，但为性能和日志完整性考虑（管理员可能被删除）

---

### 2.5 活动类型字典表（activity_types）

**表说明**：活动类型字典表，便于管理和扩展活动类型

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 | 索引 |
|--------|---------|------|---------|--------|------|------|
| id | INT | 11 | NOT NULL | AUTO_INCREMENT | 类型ID，主键 | PRIMARY KEY |
| type_code | VARCHAR | 50 | NOT NULL | - | 类型编码 | UNIQUE |
| type_name | VARCHAR | 50 | NOT NULL | - | 类型名称 | - |
| type_icon | VARCHAR | 200 | NULL | - | 类型图标URL | - |
| type_color | VARCHAR | 20 | NULL | - | 类型显示颜色（十六进制） | - |
| sort_order | INT | 11 | NOT NULL | 0 | 排序顺序 | INDEX |
| is_enabled | TINYINT | 1 | NOT NULL | 1 | 是否启用：0-禁用，1-启用 | INDEX |
| description | VARCHAR | 200 | NULL | - | 类型描述 | - |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 记录创建时间 | - |
| update_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 记录更新时间 | - |

**索引设计**：
```sql
PRIMARY KEY (id),
UNIQUE INDEX uk_type_code (type_code),
INDEX idx_sort_order (sort_order),
INDEX idx_is_enabled (is_enabled)
```

**初始数据**：
```sql
INSERT INTO activity_types (type_code, type_name, sort_order, is_enabled) VALUES
('ACADEMIC', '学术讲座', 1, 1),
('SPORTS', '文体活动', 2, 1),
('VOLUNTEER', '志愿服务', 3, 1),
('CLUB', '社团活动', 4, 1),
('COMPETITION', '竞赛活动', 5, 1),
('OTHER', '其他', 99, 1);
```

---

## 三、表关系说明

### 3.1 逻辑外键关系

```
administrators (1) ----< (N) activities
    一个管理员可以创建多个活动
    关系字段：activities.creator_id -> administrators.id

activities (1) ----< (N) registrations
    一个活动可以有多个报名记录
    关系字段：registrations.activity_id -> activities.id

administrators (1) ----< (N) system_logs
    一个管理员可以有多条操作日志
    关系字段：system_logs.admin_id -> administrators.id

activity_types (1) ----< (N) activities（可选）
    一个活动类型可以对应多个活动
    关系字段：activities.activity_type -> activity_types.type_code
```

### 3.2 数据一致性保证

由于使用逻辑外键，需要在应用层保证数据一致性：

1. **级联查询**：在Service层实现关联数据的查询逻辑
2. **数据校验**：在插入/更新前校验关联记录是否存在
3. **事务控制**：使用@Transactional确保关联操作的原子性
4. **软删除**：使用is_deleted标记，避免物理删除导致的数据不一致

---

## 四、建表SQL脚本

### 4.1 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS activities_dev 
DEFAULT CHARACTER SET utf8mb4 
DEFAULT COLLATE utf8mb4_unicode_ci;

USE activities_dev;
```

### 4.2 管理员表

```sql
DROP TABLE IF EXISTS administrators;

CREATE TABLE administrators (
    id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '管理员ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码（BCrypt加密）',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    phone VARCHAR(20) DEFAULT NULL COMMENT '手机号码',
    email VARCHAR(100) DEFAULT NULL COMMENT '电子邮箱',
    department VARCHAR(100) DEFAULT NULL COMMENT '所属部门',
    role_type TINYINT(1) NOT NULL DEFAULT 1 COMMENT '角色类型：1-普通管理员，2-超级管理员',
    account_status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '账号状态：0-禁用，1-启用',
    last_login_time DATETIME DEFAULT NULL COMMENT '最后登录时间',
    last_login_ip VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '软删除标记：0-未删除，1-已删除',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    UNIQUE KEY uk_username (username),
    KEY idx_phone (phone),
    KEY idx_email (email),
    KEY idx_role_type (role_type),
    KEY idx_account_status (account_status),
    KEY idx_is_deleted (is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='管理员表';
```

### 4.3 活动类型表（可选）

```sql
DROP TABLE IF EXISTS activity_types;

CREATE TABLE activity_types (
    id INT(11) NOT NULL AUTO_INCREMENT COMMENT '类型ID',
    type_code VARCHAR(50) NOT NULL COMMENT '类型编码',
    type_name VARCHAR(50) NOT NULL COMMENT '类型名称',
    type_icon VARCHAR(200) DEFAULT NULL COMMENT '类型图标URL',
    type_color VARCHAR(20) DEFAULT NULL COMMENT '类型显示颜色',
    sort_order INT(11) NOT NULL DEFAULT 0 COMMENT '排序顺序',
    is_enabled TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否启用：0-禁用，1-启用',
    description VARCHAR(200) DEFAULT NULL COMMENT '类型描述',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    UNIQUE KEY uk_type_code (type_code),
    KEY idx_sort_order (sort_order),
    KEY idx_is_enabled (is_enabled)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='活动类型字典表';

-- 插入初始数据
INSERT INTO activity_types (type_code, type_name, sort_order, is_enabled, description) VALUES
('ACADEMIC', '学术讲座', 1, 1, '各类学术讲座、报告会'),
('SPORTS', '文体活动', 2, 1, '体育比赛、文艺演出等'),
('VOLUNTEER', '志愿服务', 3, 1, '志愿者活动、公益服务'),
('CLUB', '社团活动', 4, 1, '各类学生社团组织的活动'),
('COMPETITION', '竞赛活动', 5, 1, '各类竞赛、比赛活动'),
('OTHER', '其他', 99, 1, '其他类型活动');
```

### 4.4 活动表

```sql
DROP TABLE IF EXISTS activities;

CREATE TABLE activities (
    id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '活动ID',
    activity_name VARCHAR(100) NOT NULL COMMENT '活动名称',
    activity_description TEXT NOT NULL COMMENT '活动描述',
    activity_type VARCHAR(50) DEFAULT '其他' COMMENT '活动类型',
    activity_status TINYINT(1) NOT NULL DEFAULT 0 COMMENT '活动状态：0-未发布，1-报名中，2-报名结束，3-进行中，4-已结束，5-已取消',
    start_time DATETIME NOT NULL COMMENT '活动开始时间',
    end_time DATETIME NOT NULL COMMENT '活动结束时间',
    location VARCHAR(200) NOT NULL COMMENT '活动地点',
    organizer VARCHAR(100) NOT NULL COMMENT '主办方/组织者',
    contact_person VARCHAR(50) NOT NULL COMMENT '负责人姓名',
    contact_phone VARCHAR(20) NOT NULL COMMENT '联系电话',
    contact_email VARCHAR(100) DEFAULT NULL COMMENT '联系邮箱',
    poster_url VARCHAR(500) DEFAULT NULL COMMENT '活动海报URL',
    max_participants INT(11) DEFAULT NULL COMMENT '最大报名人数',
    current_participants INT(11) NOT NULL DEFAULT 0 COMMENT '当前报名人数',
    registration_start_time DATETIME DEFAULT NULL COMMENT '报名开始时间',
    registration_end_time DATETIME DEFAULT NULL COMMENT '报名截止时间',
    registration_requirement TEXT DEFAULT NULL COMMENT '报名要求说明',
    check_in_start_time DATETIME DEFAULT NULL COMMENT '签到开始时间',
    check_in_end_time DATETIME DEFAULT NULL COMMENT '签到截止时间',
    publish_time DATETIME DEFAULT NULL COMMENT '发布时间',
    creator_id BIGINT(20) NOT NULL COMMENT '创建者ID（逻辑外键）',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '软删除标记：0-未删除，1-已删除',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    KEY idx_activity_name (activity_name),
    KEY idx_activity_type (activity_type),
    KEY idx_activity_status (activity_status),
    KEY idx_start_time (start_time),
    KEY idx_registration_end_time (registration_end_time),
    KEY idx_publish_time (publish_time),
    KEY idx_creator_id (creator_id),
    KEY idx_is_deleted (is_deleted),
    KEY idx_status_deleted (activity_status, is_deleted)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='活动表';
```

### 4.5 报名记录表

```sql
DROP TABLE IF EXISTS registrations;

CREATE TABLE registrations (
    id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '报名ID',
    activity_id BIGINT(20) NOT NULL COMMENT '活动ID（逻辑外键）',
    student_name VARCHAR(50) NOT NULL COMMENT '学生姓名',
    student_phone VARCHAR(20) NOT NULL COMMENT '学生手机号',
    student_college VARCHAR(100) NOT NULL COMMENT '学生学院',
    student_major VARCHAR(100) DEFAULT NULL COMMENT '学生专业',
    student_grade VARCHAR(20) DEFAULT NULL COMMENT '学生年级',
    registration_status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '报名状态：1-报名成功，2-已取消，3-已拒绝',
    check_in_status TINYINT(1) NOT NULL DEFAULT 0 COMMENT '签到状态：0-未签到，1-已签到，2-请假',
    check_in_time DATETIME DEFAULT NULL COMMENT '签到时间',
    cancel_time DATETIME DEFAULT NULL COMMENT '取消报名时间',
    cancel_reason VARCHAR(500) DEFAULT NULL COMMENT '取消原因',
    remark VARCHAR(500) DEFAULT NULL COMMENT '备注信息',
    registration_source VARCHAR(50) DEFAULT 'WEB' COMMENT '报名来源',
    registration_ip VARCHAR(50) DEFAULT NULL COMMENT '报名IP地址',
    is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '软删除标记：0-未删除，1-已删除',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '报名时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    KEY idx_activity_id (activity_id),
    KEY idx_student_name (student_name),
    KEY idx_student_phone (student_phone),
    KEY idx_student_college (student_college),
    KEY idx_registration_status (registration_status),
    KEY idx_check_in_status (check_in_status),
    KEY idx_create_time (create_time),
    KEY idx_is_deleted (is_deleted),
    UNIQUE KEY uk_activity_phone (activity_id, student_phone, is_deleted),
    KEY idx_activity_checkin (activity_id, check_in_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='报名记录表';
```

### 4.6 系统操作日志表

```sql
DROP TABLE IF EXISTS system_logs;

CREATE TABLE system_logs (
    id BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    admin_id BIGINT(20) DEFAULT NULL COMMENT '操作管理员ID（逻辑外键）',
    admin_username VARCHAR(50) DEFAULT NULL COMMENT '操作管理员用户名',
    operation_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    operation_module VARCHAR(50) NOT NULL COMMENT '操作模块',
    operation_description VARCHAR(500) DEFAULT NULL COMMENT '操作描述',
    request_method VARCHAR(10) DEFAULT NULL COMMENT '请求方法',
    request_url VARCHAR(500) DEFAULT NULL COMMENT '请求URL',
    request_params TEXT DEFAULT NULL COMMENT '请求参数',
    request_ip VARCHAR(50) DEFAULT NULL COMMENT '请求IP地址',
    user_agent VARCHAR(500) DEFAULT NULL COMMENT '浏览器User-Agent',
    operation_status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '操作状态：0-失败，1-成功',
    error_message TEXT DEFAULT NULL COMMENT '错误信息',
    execution_time INT(11) DEFAULT NULL COMMENT '执行耗时（毫秒）',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    PRIMARY KEY (id),
    KEY idx_admin_id (admin_id),
    KEY idx_admin_username (admin_username),
    KEY idx_operation_type (operation_type),
    KEY idx_operation_module (operation_module),
    KEY idx_request_ip (request_ip),
    KEY idx_operation_status (operation_status),
    KEY idx_create_time (create_time),
    KEY idx_admin_time (admin_id, create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统操作日志表';
```

---

## 五、初始化数据

### 5.1 创建默认管理员账号

```sql
-- 密码：admin123（需要在应用中使用BCrypt加密后再插入）
-- BCrypt密码示例：$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi

INSERT INTO administrators (username, password, real_name, phone, email, department, role_type, account_status) 
VALUES 
('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi', '系统管理员', '13800138000', 'admin@example.com', '信息技术部', 2, 1),
('operator', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi', '活动管理员', '13800138001', 'operator@example.com', '学生活动中心', 1, 1);
```

---



## 六、数据字典

### 67.1 活动状态枚举

| 值 | 说明 | 备注 |
|----|------|------|
| 0 | 未发布 | 活动创建后的初始状态 |
| 1 | 报名中 | 活动已发布，正在接受报名 |
| 2 | 报名结束 | 已过报名截止时间 |
| 3 | 进行中 | 活动正在进行 |
| 4 | 已结束 | 活动已结束 |
| 5 | 已取消 | 活动被取消 |

### 6.2 报名状态枚举

| 值 | 说明 | 备注 |
|----|------|------|
| 1 | 报名成功 | 正常报名状态 |
| 2 | 已取消 | 学生主动取消报名 |
| 3 | 已拒绝 | 管理员拒绝报名 |

### 6.3 签到状态枚举

| 值 | 说明 | 备注 |
|----|------|------|
| 0 | 未签到 | 已报名但未签到 |
| 1 | 已签到 | 已完成签到 |
| 2 | 请假 | 请假缺席 |

### 6.4 角色类型枚举

| 值 | 说明 | 备注 |
|----|------|------|
| 1 | 普通管理员 | 基本活动管理权限 |
| 2 | 超级管理员 | 全部管理权限，包括用户管理 |

### 6.5 操作类型枚举

| 值 | 说明 |
|----|------|
| LOGIN | 登录系统 |
| LOGOUT | 登出系统 |
| CREATE_ACTIVITY | 创建活动 |
| UPDATE_ACTIVITY | 更新活动 |
| DELETE_ACTIVITY | 删除活动 |
| PUBLISH_ACTIVITY | 发布活动 |
| VIEW_REGISTRATIONS | 查看报名列表 |
| EXPORT_REGISTRATIONS | 导出报名数据 |

